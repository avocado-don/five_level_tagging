# アプリケーション名
Five Level Tagging　(5段階タグ付けアプリ)  
<br>

# アプリケーションURL
http://3.115.163.111/  

※Basic認証(ID/Pass)、テスト用アカウント(メールアドレス/パスワード)は、履歴書・職務経歴書に記載。
<br>
<br>

# アプリケーション概要
(1)リストの各項目(アイテム)に最大4種の「特徴タグ」と「5段階スコア」を登録することで、特徴の数値化・一覧化ができる。  

(2)他ユーザーの作ったリストやアイテム(タグ・スコア)も含め、並び替え・検索ができる。  
<br>

## アプリケーションの使用例
(1)音楽・書籍・映像など各種作品の、評価項目と評価値をリスト化する。  
　「泣ける:1」「怖い:5」の映画など。  
<br>
(2)献立ストックリストを検索。献立の組み合わせを考えやすくする。  
　「甘さ:3」「食べ応え:2」のプリンと、「塩味:2」「食べ応え:3」の厚焼きせんべい。  
<br>
(3)行事ストックリストを作成。実施難易度の高さで5段階数値化。行事の実施時期・順番を考えやすくする。  
　「よける:2」「協力:1」「危険性:2」のチーム鬼ごっこで、簡単な運動遊び・協力遊びを4月に企画する。  
　「よける:3」「協力:3」「危険性:3」のドッジボールは、身体能力や協調性の成長を見計らって、7月を目安に企画する。  
<br>

## アプリケーションを作成した背景
　保育士時代、過去の献立や行事を参照したい時、毎月の献立表や個別の行事報告書を何枚もめくって探すような、アナログな環境だった。  
　改善策として、エクセルで記録を一覧化し、蓄積・検索しやすくした。  
　献立や行事の特徴と程度(タグとスコア)も簡潔に記録することで、「体験」の組み合わせや順番に意図を込めて計画しやすくなった。  
　便宜的・簡易的な数値化により、抽象的・曖昧な事柄についても、特徴の把握・比較と選択がしやすくなった。  
　ただし、当時はあくまでイチ施設内で完結する記録であった。  
<br>
　今回、アプリ化して公開することで、メリットをさらに発展させられると考えた。  
　他ユーザーの作ったリストやアイテム(タグ・スコア)も参照できるようになる。  
　異なる他者の経験・アイディア・価値尺度に出会い、刺激やヒントを得られる。  
　公開リストなら見知らぬ人と、限定公開リストなら企業内やチーム内で、共同編集も可能になる。  
　今回はリスト・タグのジャンルを限定しないことで、様々な業務あるいは趣味の記録にも対応可能性を広げた。  
　(仮に大規模市場または特定業界向けで運用するなら、ジャンル別のUIやDBでアプリを独立させた方が実用的か。)  
<br>
<br>

# 実装済みの機能
### 1. リストの投稿
(1)トップページ(＝リスト一覧ページ)にアクセスする。ヘッダーからユーザー登録・ログインする。  
(2)リスト新規投稿をクリックする。  
(3)リストのタイトル・コンセプト・数値化ルールを入力して投稿する。  
　※数値化ルールには、タグのスコア1~5それぞれの段階・程度を表す言葉や代表例などの記載を推奨。  
<br>

### 2. アイテム(リスト内の各項目)・タグ・スコアの投稿
(1)リスト一覧ページで、自作のリストタイトル(リスト詳細ページ)をクリックする。  
(2)リスト詳細ページで、アイテム新規投稿をクリックする。  
(3)アイテムの項目名・説明・タグ・スコアを入力し、画像を添付して投稿する。  
　※タグとスコアは最大4組入力できる。タグのみの保存はできるが、タグに紐づかないスコアのみの保存はできない。  
<br>

### 3. リスト一覧・アイテム一覧の並び替え
(1)リスト一覧ページの並び替えボタン各種をクリックするたびに、昇順・降順を切り替える(タイトル・作者名・更新日時)。  
(2)アイテム一覧ページ(＝リスト詳細ページ)の並び替えボタン各種をクリックするたびに、昇順・降順を切り替える(項目名・更新日時)。  
　※アイテムに紐づくタグ・スコアも、アイテムごと並び換えられる。  
<br>

# 実装予定の機能
### 4. ユーザー詳細ページの表示
<br>

### 5. リスト・アイテムの検索
<br>

### 6. タグの検索
<br>

### 7. ユーザーのフォロー
<br>

### 8. リストのマイリスト登録
<br>

### 9. 全体公開リスト・限定公開リストの選択投稿
<br>

### 10. アイテムの画像拡大
<br>

### 11. 使い方ガイドの表示ボタン(非同期通信)
<br>

### 12. CSSの装飾
※開発中アプリにつき、ユーザー目線の説明やレイアウト装飾は、一通りの機能実装後に着手する。(仮のbrタグやスペースキー空白のcss化など)
<br>
<br>

# 要件定義
[リンク：Googleスプレッドシート](https://docs.google.com/spreadsheets/d/10B7zKWsc7uPWMbjWP8jSZ0URIDiKXv5PVb-Rytln0PM/edit#gid=219665282)  
<br>

# データベース設計
![画像：ER図](app/assets/images/readme/ER.png)
<br>
<br>

# 画面遷移図
![画像：画面遷移図](app/assets/images/readme/PageTransition.png)
<br>
<br>

# 開発環境
HTML・CSS・Ruby・JavaScript・SQL・GitHub・AWS  
[リンク：GitHubリポジトリ](https://github.com/avocado-don/five_level_tagging)  
[リンク：GitHubプロジェクトボード](https://github.com/users/avocado-don/projects/2/views/1)　※各タスク内に作成手順を記録。  
<br>

# ローカルでの動作方法
% git clone https://github.com/avocado-don/five_level_tagging  
% cd five_level_tagging  
% bundle install  
<br>
<br>

# 工夫した点
<br>

## [ 1 ] 1つのアイテムに紐づく4組のタグとスコアを、アイテム投稿ボタン1クリックで保存可能にする。
　上記「実装済みの機能」の「2. アイテム(リスト内の各項目)・タグ・スコアの投稿」に該当。  
<br>

### (1)テーブル設計：アイテム、タグ、中間テーブル(スコアも含めて保存)。

　カラムの正規化の観点から、1アイテムのカラムに4組の同種データを保存することはしない。他のテーブルに4つのレコードとして保存する。  
　タグとスコアの組み合わせは、1アイテムに固有の情報である。一方で、タグ自体は他ユーザー・他リストでの使い回し・検索に対応させる。  
　従って、タグテーブルにはスコアを含めず、タグ名のみ保存する。スコアは、中間テーブルにアイテムID・タグIDと共に保存する。  
<br>

### (2)入力フォーム：タグ・スコアの入力欄を4つずつ設置。(タグ1→スコア1→タグ2→スコア2→…の順番。)

　複数タグの一括入力方法として、1つの入力欄内でスペースやカンマで区切る方法は採用しない。  
　1つのタグ入力欄にどのスコア入力欄が紐づいているか、ユーザーの視覚・直感を考慮し、入力欄を並べた。  
<br>

### (3)タグ(tag_name)・スコア(score)4つずつを、配列に格納して送信。

　text_fieldのname属性をitem_form[tag_names][]、item_form[scores][]と設定。  
<br>
![画像：工夫1-3](app/assets/images/readme/point1-3.png)
<br>
<br>

### (4)ストロングパラメーターで配列の受け取りを許可。

　params.require(:item_form).permit(tag_names: [], scores: [])と設定。(※他のキーは記載省略。)  
<br>
![画像：工夫1-4](app/assets/images/readme/point1-4.png)
<br>
<br>

### (5)フォームオブジェクト(ItemForm)クラス内で配列の読み書きを許可。
　attr_accessorで、tag_namesとscoresを指定。  
<br>

### (6)フォームオブジェクト内でsaveメソッドを作り、配列内の値を4つのレコードに分けて保存。

　メソッド内で、アイテム、タグ、中間テーブル(スコアも含む)を順次保存する。アイテムは入力必須、タグとスコアは入力任意。  

　タグの配列tag_namesにeach_with_indexメソッドを使う。メリットは2つ。  

　メリット1(each)：配列から順次取り出したtag_nameに値が入っている場合(if tag_name.present?)、タグの保存処理に移行する。  
　tag_nameにfirst_or_initializeメソッドを使い、同名のタグが過去に存在しない場合は新規タグを保存する。存在する場合は既存タグのIDを保存する。  

　タグがフォームで入力されていない場合、空の値も配列に含まれて送られてくるので、それをtag_nameとして取り出した際はタグを保存しない。  
　なお、タグに紐づかないスコアだけを保存することはない(フォーム上でタグが空欄のまま、スコアが入力されたとしても)。アイテムのみ保存して処理を終了する。  

　メリット2(with_index)：タグの配列に添字を付与する。index0~3。tag_names[0]を取り出している間は、同じ添字でscores[0]も取り出せる。  
　タグに紐づいたスコアが存在している場合のみ(if scores[index].present?
)、アイテム・タグの紐付けをスコアと共に中間テーブルへ保存する。  
　タグは存在し、スコアが存在しなければ、アイテム・タグのみの紐付けを保存する。  
<br>
![画像：工夫1-6](app/assets/images/readme/point1-6.png)
<br>
<br>

### (7)editアクション：アイテムに紐づく複数レコードのカラムを指定し、タグ・スコアの値を配列として取得する。

　pluckメソッド：itemに紐づく(tags / item_tags)レコードの(tag_name / score)カラムの値を配列化。  

　※newアクション：フォームに部分テンプレートを用いているため、投稿フォームのエラーを回避するうえで、空のインスタンスを用意する。  
よりスマートな方法がある気はするが、限られた時間で仮説検証してエラー回避できたので、更なる開発を優先する。  
<br>
![画像：工夫1-7](app/assets/images/readme/point1-7.png)
<br>
<br>

### (8)アイテム編集フォーム：保存済みタグ・スコアの値を、入力欄の初期値として読み込む。

　配列(@item_form.tag_names / @item_form.scores)から値を順次取り出し、入力欄の初期値(value)として読み込む。  
　(入力欄を4つ生成するための)繰り返し処理(times)の際にブロック変数(index)も生成し、配列の添字[index]として使うことで、値を取り出す。  
<br>
![画像：工夫1-8](app/assets/images/readme/point1-8.png)
<br>
<br>

### (9)フォームオブジェクト内でupdateメソッドを作り、アイテム・タグ・スコアを更新する。

　アイテムとタグの既存の紐付け(item_tags)をいったん削除(destroy_all)する。  

　タグ・スコアをparamsから削除(delete)しつつ、その返り値を使ってタグ・スコアの配列(tag_names / scores)を定義する(のちの更新処理に使う)。  
　アイテムに関する情報だけが残ったparamsを使い、アイテムを更新する。  

　以降、タグ・スコアの更新処理は新規保存時と同様。  
<br>
![画像：工夫1-9](app/assets/images/readme/point1-9.png)
<br>
<br>
